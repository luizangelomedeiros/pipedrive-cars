angular.module("pipedriveCars").controller("CrudCarController",["$filter","$scope",function(e,r){var a=[{id:1,user:22,model:"Ford Focus",year:2012,color:"Branco"},{id:2,user:19,model:"Fiat Palio",year:2006,color:"Preto"},{id:3,user:26,model:"Volkswagen Jetta",year:2017,color:"Verde"},{id:4,user:19,model:"Chevrolet Cruze",year:2010,color:"Verde"},{id:5,user:26,model:"Citroen C3",year:2001,color:"Preto"}],o=[{id:22,name:"Luiz"},{id:19,name:"Lucas"},{id:26,name:"Diego"}],n={id:"A123AAS4142C1239AODS13",cars:a,users:o};r.titleForm="Novo Carro",r.carId=0,r.searchToken=function(e){var a=angular.lowercase(r.tokenPipedrive);if(n.id=angular.lowercase(n.id),a===n.id)r.showInformativeText=!0,r.classMain="visible",r.cars=n.cars,r.users=n.users;else{r.showInformativeText=!1,r.classMain="";e.$name;abreAlert("Token invádio, tente novamente!")}},r.editItem=function(e){var a=returnItemCars(e);if(a.model){var o=returnItemUsers(a.user);r.newCarModel=a.model,r.newCarYear=a.year,r.newCarColor=a.color,r.newCarUser=o,r.carIndex=n.cars.map(function(e){return e.id}).indexOf(a.id),r.carId=a.id,r.classFormEdit="new-item--edit",r.titleForm="Editar Carro"}},r.addCarItem=function(e){var a=function(e,r){return r.indexOf(e)>-1},o=["branco","preto","verde"];if(r.newCarUser&&r.newCarModel&&r.newCarYear&&r.newCarColor)if(function(){return parseInt((new Date).getFullYear())-parseInt(r.newCarYear)<30}())if(a(angular.lowercase(r.newCarColor),o)){var t=n.cars.map(function(e){return e.id}),s=a(r.carId,t);if(s){var i=r.newCarUser;n.cars[r.carIndex].user=i.id,n.cars[r.carIndex].model=r.newCarModel,n.cars[r.carIndex].year=r.newCarYear,n.cars[r.carIndex].color=r.newCarColor}else{var l=0;n.cars.length>0&&(l=parseInt(n.cars[n.cars.length-1].id)),l++;var i=r.newCarUser;n.cars.push({id:l,user:i.id,model:r.newCarModel,year:r.newCarYear,color:r.newCarColor})}r.resetForm()}else abreAlert("Para cadastrar um carro, somente são permitidas as cores Branco, Preto e Verde. Tente novamente!");else abreAlert("Para cadastrar um carro, o mesmo não pode ter mais de 30 anos, tente novamente!");else{e.$name;e.$error.maxlength?abreAlert("Máximo de caracteres excedidos, tente novamente!"):e.$error.minlength?abreAlert("Mínimo de caracteres necessários para prosseguir, tente novamente!"):abreAlert("Para prosseguir preencha todos os campos!")}},r.resetForm=function(){r.newCarModel="",r.newCarYear="",r.newCarColor="",r.newCarUser="",r.carId=0,r.carIndex=-1,r.classFormEdit="",r.titleForm="Novo Carro";var e=document.querySelectorAll(".result-list__item");[].forEach.call(e,function(e){e.classList.remove("active")})},removeCar=function(e){n.cars.splice(e,1),r.resetForm()},r.mostraModal=!1,r.tarefaModal,r.itemModal="",r.abreModal=function(e){var a=e.indexCar.$viewValue,o=n.cars[a].model;r.tarefaModal=o,r.itemModal=a,r.mostraModal=!r.mostraModal},r.mostraAlert=!1,r.tipoAlert="",abreAlert=function(e,a){r.tipoAlert=e,r.formAlert=a,r.mostraAlert=!r.mostraModal},returnItemCars=function(r){return e("filter")(n.cars,function(e){return e.id===r})[0]},returnItemUsers=function(r){return e("filter")(n.users,function(e){return e.id===r})[0]}}]);